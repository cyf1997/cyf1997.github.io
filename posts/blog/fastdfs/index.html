<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>FastDFS | 图南程</title>
<meta name="keywords" content="中间件, FastDFS">
<meta name="description" content="开源的轻量级分布式文件系统">
<meta name="author" content="tunanc">
<link rel="canonical" href="https://cyf1997.github.io/posts/blog/fastdfs/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<link rel="icon" href="https://cyf1997.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://cyf1997.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://cyf1997.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://cyf1997.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://cyf1997.github.io/apple-touch-icon.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://cyf1997.github.io/posts/blog/fastdfs/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
  

<meta property="og:title" content="FastDFS" />
<meta property="og:description" content="开源的轻量级分布式文件系统" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cyf1997.github.io/posts/blog/fastdfs/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-07-20T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-07-20T00:00:00+00:00" />



<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="FastDFS"/>
<meta name="twitter:description" content="开源的轻量级分布式文件系统"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://cyf1997.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Blog",
      "item": "https://cyf1997.github.io/posts/blog/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "FastDFS",
      "item": "https://cyf1997.github.io/posts/blog/fastdfs/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "FastDFS",
  "name": "FastDFS",
  "description": "开源的轻量级分布式文件系统",
  "keywords": [
    "中间件", "FastDFS"
  ],
  "articleBody": "FastDFS 一、介绍 二、单节点安装 如果以root用户安装，不修改任何配置，默认的脚本在/usr/bin/fdfs下，配置文件在/etc/fdfs下，但是在生产上，root账户我们不能随意去使用，所以我们需要自定义用户来使用fastdfs\n安装前准备 新建用户\nuseradd fdfs 设置用户密码\npasswd fdfs 安装依赖\nyum install gcc-c++ perl-devel pcre-devel openssl-devel zlib-devel wget 软件上传到/home/fdfs/soft\n修改权限\nchown -R fdfs:fdfs /home/fdfs/ 安装开始 全程以root用户安装 1.解压安装libfastcommon-1.0.57.tar.gz\ncd /home/fdfs/soft tar -xzvf libfastcommon-1.0.57.tar.gz cd libfastcommon-1.0.57 ./make.sh ./make.sh install 2.解压安装文件fastdfs-6.08.tar.gz\ncd /home/fdfs/soft tar -xzvf fastdfs-6.08.tar.gz cd /home/fdfs/soft/fastdfs-6.08 ./make ./make install 执行复制配置脚本，将脚本复制到/etc/fdfs下\n./setup.sh 脚本命令目录在/usr/bin下\n配置文件在/etc/fdfs下\n3.配置FastDFS跟踪器(Tracker)\n修改配置tracker.conf\nvim /etc/fdfs/tracker.conf 修改内容如下\n#tracker日志和数据目录 base_path = /data/fdfs/tracker 创建base_path目录\nmkdir -p /data/fdfs/tracker 启动Tracker\n/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf start 查看 FastDFS Tracker 是否已成功启动\n/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf status 关闭Tracker命令\n/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf stop 设置Tracker开机启动\nchkconfig fdfs_trackerd on tracker server 目录及文件结构\n4.配置 FastDFS 存储 (Storage)\nvim /etc/fdfs/storage.conf 修改内容如下\n#storage的日志和数据目录 base_path=/data/fdfs/storage #实际文件存放目录 store_path0=/data/fdfs/storage/files #tracker的ip,多个就往下复制 tracker_server=ip:22122 创建对应目录\nmkdir -p /data/fdfs/storage/files 启动 Storage\n/usr/bin/fdfs_storaged /etc/fdfs/storage.conf start 查看storage服务状态\nservice fdfs_storaged status 关闭Storage\n/usr/bin/fdfs_storaged /etc/fdfs/storage.conf stop 查看Storage和Tracker是否在通信：\n/usr/bin/fdfs_monitor /etc/fdfs/storage.conf 设置 Storage 开机启动\nchkconfig fdfs_storaged on Storage 目录\n同 Tracker，Storage 启动成功后，在base_path 下创建了data、logs目录，记录着 Storage Server 的信息。 在 store_path0/data 目录下，创建了N*N个子目录：\n[root@iZ2zej7sidrziz9jw6nozvZ data]# pwd /data/fdfs/storage/files/data [root@iZ2zej7sidrziz9jw6nozvZ data]# ls 00 06 0C 12 18 1E 24 2A 30 36 3C 42 48 4E 54 5A 60 66 6C 72 78 7E 84 8A 90 96 9C A2 A8 AE B4 BA C0 C6 CC D2 D8 DE E4 EA F0 F6 FC 01 07 0D 13 19 1F 25 2B 31 37 3D 43 49 4F 55 5B 61 67 6D 73 79 7F 85 8B 91 97 9D A3 A9 AF B5 BB C1 C7 CD D3 D9 DF E5 EB F1 F7 FD 02 08 0E 14 1A 20 26 2C 32 38 3E 44 4A 50 56 5C 62 68 6E 74 7A 80 86 8C 92 98 9E A4 AA B0 B6 BC C2 C8 CE D4 DA E0 E6 EC F2 F8 FE 03 09 0F 15 1B 21 27 2D 33 39 3F 45 4B 51 57 5D 63 69 6F 75 7B 81 87 8D 93 99 9F A5 AB B1 B7 BD C3 C9 CF D5 DB E1 E7 ED F3 F9 FF 04 0A 10 16 1C 22 28 2E 34 3A 40 46 4C 52 58 5E 64 6A 70 76 7C 82 88 8E 94 9A A0 A6 AC B2 B8 BE C4 CA D0 D6 DC E2 E8 EE F4 FA 05 0B 11 17 1D 23 29 2F 35 3B 41 47 4D 53 59 5F 65 6B 71 77 7D 83 89 8F 95 9B A1 A7 AD B3 B9 BF C5 CB D1 D7 DD E3 E9 EF F5 FB 4.配置client\n修改 Tracker 服务器中的客户端配置文件\nvim /etc/fdfs/client.conf 修改内容如下\n#client的日志和数据目录 base_path=/data/fdfs/client #tracker的ip端口 tracker_server=ip:22122 创建对应目录\nmkdir -p /data/fdfs/client 上传测试\n/usr/bin/fdfs_test /etc/fdfs/client.conf upload 1234.jpg 成功后信息\nThis is FastDFS client test program v6.08 Copyright (C) 2008, Happy Fish / YuQing FastDFS may be copied only under the terms of the GNU General Public License V3, which may be found in the FastDFS source kit. Please visit the FastDFS Home Page http://www.fastken.com/ for more detail. [2022-08-09 10:39:12] DEBUG - base_path=/data/fdfs/client, connect_timeout=5, network_timeout=60, tracker_server_count=1, anti_steal_token=0, anti_steal_secret_key length=0, use_connection_pool=0, g_connection_pool_max_idle_time=3600s, use_storage_id=0, storage server id count: 0 tracker_query_storage_store_list_without_group: server 1. group_name=, ip_addr=172.18.59.251, port=23000 group_name=group1, ip_addr=172.18.59.251, port=23000 storage_upload_by_filename group_name=group1, remote_filename=M00/00/00/rBI7-2LxyNCAA_omAAF1-ZVeThs421.jpg source ip address: 172.18.59.251 file timestamp=2022-08-09 10:39:12 file size=95737 file crc32=2505985563 example file url: http://172.18.59.251/group1/M00/00/00/rBI7-2LxyNCAA_omAAF1-ZVeThs421.jpg storage_upload_slave_by_filename group_name=group1, remote_filename=M00/00/00/rBI7-2LxyNCAA_omAAF1-ZVeThs421_big.jpg source ip address: 172.18.59.251 file timestamp=2022-08-09 10:39:12 file size=95737 file crc32=2505985563 example file url: http://172.18.59.251/group1/M00/00/00/rBI7-2LxyNCAA_omAAF1-ZVeThs421_big.jpg 上传成功后返回文件路径：group1/M00/00/00/rBI7-2LxyNCAA_omAAF1-ZVeThs421.jpg 返回的文件路径由group、存储目录、两级子目录、fileid、文件后缀名（由客户端指定，主要用于区分文件类型）拼接而成。\n5.修改权限\n默认都是用root安装的\n如果想以fdfs来维护可以修改权限\nchown -R fdfs:fdfs /usr/bin/fdfs_* chown -R fdfs:fdfs /etc/fdfs chown -R fdfs:fdfs /data/fdfs FastDFS 配置 Nginx 模块 FastDFS 通过 Tracker 服务器，将文件放在 Storage 服务器存储， 但是同组存储服务器之间需要进行文件复制， 有同步延迟的问题。\n假设 Tracker 服务器将文件上传到了 192.168.51.128，上传成功后文件 ID已经返回给客户端。\n此时 FastDFS 存储集群机制会将这个文件同步到同组存储 192.168.51.129，在文件还没有复制完成的情况下，客户端如果用这个文件 ID 在 192.168.51.129 上取文件,就会出现文件无法访问的错误。\n而 fastdfs-nginx-module 可以重定向文件链接到源服务器取文件，避免客户端由于复制延迟导致的文件无法访问错误。\n还是以root用户安装\ncd /home/fdfs/soft tar -xzvf fastdfs-nginx-module-1.22.tar.gz cd /home/fdfs/soft/fastdfs-nginx-module-1.22/src cp mod_fastdfs.conf /etc/fdfs vim /etc/fdfs/mod_fastdfs.conf mod_fastdfs.conf修改内容如下\nbase_path=/data/fdfs/mod #tracker服务的ip+端口 tracker_server=172.18.59.251:22122 #如果文件路径的uri中包含/group**，则要设置为true url_have_group_name = true #同stroage服务的store_path0 store_path0=/data/fdfs/storage/files 创建目录\nmkdir -p /data/fdfs/mod 配置nginx，添加fastdfs-nginx-module 模块 （注意如果已经安装过nginx，那么先nginx/sbin/nginx -V看下原本的配置）\n/usr/local/nginx/sbin/nginx -V 复制好结果备用\n重新编译nginx\n# 先停掉nginx服务 /usr/local/nginx/sbin/nginx -s stop #进入nginx源码目录 cd /usr/local/src/nginx-1.9.9/ #添加fastdfs-nginx-module 模块 ./configure --prefix=/usr/local/nginx --with-http_ssl_module --add-module=/home/fdfs/soft/fastdfs-nginx-module-1.22/src #重新编译安装nginx make #复制新的命令到sbin cp /usr/local/nginx/nginx-1.9.9/objs/nginx /usr/local/nginx/sbin #验证是否加载fastdfs-nginx-module模块是否 ，有如下标红部分表示成功 /usr/local/nginx/sbin/nginx -V 修改nginx.conf\n#添加如下内容 location ~/group([0-9])/M00 { ngx_fastdfs_module; } 启动nginx\n/user/local/nginx/sbin/nginx 在浏览器访问\n文件路径可以在使用fdfs_test再上传一个，复制返回的路径用来测试\nhttp://ip:port/group1/M00/00/00/rBI7-2LzrLeAOkOqAAF1-ZVeThs773_big.jpg\n",
  "wordCount" : "652",
  "inLanguage": "en",
  "datePublished": "2024-07-20T00:00:00Z",
  "dateModified": "2024-07-20T00:00:00Z",
  "author":[{
    "@type": "Person",
    "name": "tunanc"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://cyf1997.github.io/posts/blog/fastdfs/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "图南程",
    "logo": {
      "@type": "ImageObject",
      "url": "https://cyf1997.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://cyf1997.github.io/" accesskey="h" title="图南程 (Alt + H)">图南程</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://cyf1997.github.io/search" title="🔍搜索 (Alt &#43; /)" accesskey=/>
                    <span>🔍搜索</span>
                </a>
            </li>
            <li>
                <a href="https://cyf1997.github.io/" title="🏠主页">
                    <span>🏠主页</span>
                </a>
            </li>
            <li>
                <a href="https://cyf1997.github.io/posts" title="📚文章">
                    <span>📚文章</span>
                </a>
            </li>
            <li>
                <a href="https://cyf1997.github.io/archives/" title="⏱时间轴">
                    <span>⏱时间轴</span>
                </a>
            </li>
            <li>
                <a href="https://cyf1997.github.io/tags" title="🔖标签">
                    <span>🔖标签</span>
                </a>
            </li>
            <li>
                <a href="https://cyf1997.github.io/about" title="🙋🏻‍♂️关于">
                    <span>🙋🏻‍♂️关于</span>
                </a>
            </li>
            <li>
                <a href="https://cyf1997.github.io/links" title="🤝友链">
                    <span>🤝友链</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://cyf1997.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://cyf1997.github.io/posts/">Posts</a>&nbsp;»&nbsp;<a href="https://cyf1997.github.io/posts/blog/">Blog</a></div>
    <h1 class="post-title entry-hint-parent">
      FastDFS
    </h1>
    <div class="post-description">
      开源的轻量级分布式文件系统
    </div>
    <div class="post-meta"><span title='2024-07-20 00:00:00 +0000 UTC'>July 20, 2024</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;tunanc

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#fastdfs" aria-label="FastDFS">FastDFS</a><ul>
                        
                <li>
                    <a href="#%e4%b8%80%e4%bb%8b%e7%bb%8d" aria-label="一、介绍">一、介绍</a></li>
                <li>
                    <a href="#%e4%ba%8c%e5%8d%95%e8%8a%82%e7%82%b9%e5%ae%89%e8%a3%85" aria-label="二、单节点安装">二、单节点安装</a><ul>
                        
                <li>
                    <a href="#%e5%ae%89%e8%a3%85%e5%89%8d%e5%87%86%e5%a4%87" aria-label="安装前准备">安装前准备</a></li>
                <li>
                    <a href="#%e5%ae%89%e8%a3%85%e5%bc%80%e5%a7%8b" aria-label="安装开始">安装开始</a></li>
                <li>
                    <a href="#fastdfs-%e9%85%8d%e7%bd%ae-nginx-%e6%a8%a1%e5%9d%97" aria-label="FastDFS 配置 Nginx 模块">FastDFS 配置 Nginx 模块</a>
                </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="fastdfs">FastDFS<a hidden class="anchor" aria-hidden="true" href="#fastdfs">#</a></h1>
<p><a href="https://github.com/happyfish100/fastdfs"><img loading="lazy" src="https://img.shields.io/badge/github-fastdfs-%2342b983" alt="github"  />
</a></p>
<h2 id="一介绍">一、介绍<a hidden class="anchor" aria-hidden="true" href="#一介绍">#</a></h2>
<h2 id="二单节点安装">二、单节点安装<a hidden class="anchor" aria-hidden="true" href="#二单节点安装">#</a></h2>
<p>如果以root用户安装，不修改任何配置，默认的脚本在<code>/usr/bin/fdfs</code>下，配置文件在<code>/etc/fdfs</code>下，但是在生产上，root账户我们不能随意去使用，所以我们需要自定义用户来使用fastdfs</p>
<h3 id="安装前准备">安装前准备<a hidden class="anchor" aria-hidden="true" href="#安装前准备">#</a></h3>
<p>新建用户</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>useradd fdfs
</span></span></code></pre></div><p>设置用户密码</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>passwd fdfs
</span></span></code></pre></div><p>安装依赖</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>yum install gcc-c++ perl-devel pcre-devel openssl-devel zlib-devel wget
</span></span></code></pre></div><p>软件上传到<code>/home/fdfs/soft</code></p>
<p>修改权限</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>chown -R fdfs:fdfs /home/fdfs/
</span></span></code></pre></div><h3 id="安装开始">安装开始<a hidden class="anchor" aria-hidden="true" href="#安装开始">#</a></h3>
<p>全程以root用户安装
<strong>1.解压安装<code>libfastcommon-1.0.57.tar.gz</code></strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>cd /home/fdfs/soft
</span></span><span style="display:flex;"><span>tar -xzvf libfastcommon-1.0.57.tar.gz
</span></span><span style="display:flex;"><span>cd libfastcommon-1.0.57
</span></span><span style="display:flex;"><span>./make.sh
</span></span><span style="display:flex;"><span>./make.sh install
</span></span></code></pre></div><p><strong>2.解压安装文件<code>fastdfs-6.08.tar.gz</code></strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>cd /home/fdfs/soft
</span></span><span style="display:flex;"><span>tar -xzvf fastdfs-6.08.tar.gz
</span></span><span style="display:flex;"><span>cd /home/fdfs/soft/fastdfs-6.08
</span></span><span style="display:flex;"><span>./make
</span></span><span style="display:flex;"><span>./make install
</span></span></code></pre></div><p>执行复制配置脚本，将脚本复制到/etc/fdfs下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>./setup.sh
</span></span></code></pre></div><p>脚本命令目录在<code>/usr/bin</code>下</p>
<p><img loading="lazy" src="usr-bin.jpg" alt="图片"  />
</p>
<p>配置文件在<code>/etc/fdfs</code>下</p>
<p><img loading="lazy" src="etc-fdfs.jpg" alt="图片"  />
</p>
<p><strong>3.配置FastDFS跟踪器(Tracker)</strong></p>
<p>修改配置<code>tracker.conf</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>vim /etc/fdfs/tracker.conf
</span></span></code></pre></div><p>修改内容如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#tracker日志和数据目录</span>
</span></span><span style="display:flex;"><span>base_path <span style="color:#f92672">=</span> /data/fdfs/tracker
</span></span></code></pre></div><p>创建<code>base_path</code>目录</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mkdir -p /data/fdfs/tracker
</span></span></code></pre></div><p>启动Tracker</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf start
</span></span></code></pre></div><p>查看 FastDFS Tracker 是否已成功启动</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf status
</span></span></code></pre></div><p>关闭Tracker命令</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf stop
</span></span></code></pre></div><p>设置Tracker开机启动</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>chkconfig fdfs_trackerd on
</span></span></code></pre></div><p>tracker server 目录及文件结构</p>
<p><img loading="lazy" src="tracker-tree.jpg" alt="图片"  />
</p>
<p><strong>4.配置 FastDFS 存储 (Storage)</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>vim /etc/fdfs/storage.conf
</span></span></code></pre></div><p>修改内容如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#storage的日志和数据目录</span>
</span></span><span style="display:flex;"><span>base_path<span style="color:#f92672">=</span>/data/fdfs/storage
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#实际文件存放目录</span>
</span></span><span style="display:flex;"><span>store_path0<span style="color:#f92672">=</span>/data/fdfs/storage/files
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#tracker的ip,多个就往下复制</span>
</span></span><span style="display:flex;"><span>tracker_server<span style="color:#f92672">=</span>ip:22122
</span></span></code></pre></div><p>创建对应目录</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mkdir -p /data/fdfs/storage/files
</span></span></code></pre></div><p>启动 Storage</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/usr/bin/fdfs_storaged /etc/fdfs/storage.conf start
</span></span></code></pre></div><p>查看storage服务状态</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>service fdfs_storaged status
</span></span></code></pre></div><p>关闭Storage</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/usr/bin/fdfs_storaged /etc/fdfs/storage.conf stop
</span></span></code></pre></div><p>查看Storage和Tracker是否在通信：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/usr/bin/fdfs_monitor /etc/fdfs/storage.conf
</span></span></code></pre></div><p>设置 Storage 开机启动</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>chkconfig fdfs_storaged on
</span></span></code></pre></div><p>Storage 目录</p>
<p>同 Tracker，Storage 启动成功后，在base_path 下创建了data、logs目录，记录着 Storage Server 的信息。
在 store_path0/data 目录下，创建了N*N个子目录：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>    <span style="color:#f92672">[</span>root@iZ2zej7sidrziz9jw6nozvZ data<span style="color:#f92672">]</span><span style="color:#75715e"># pwd</span>
</span></span><span style="display:flex;"><span>    /data/fdfs/storage/files/data
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[</span>root@iZ2zej7sidrziz9jw6nozvZ data<span style="color:#f92672">]</span><span style="color:#75715e"># ls</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">00</span>  <span style="color:#ae81ff">06</span>  0C  <span style="color:#ae81ff">12</span>  <span style="color:#ae81ff">18</span>  1E  <span style="color:#ae81ff">24</span>  2A  <span style="color:#ae81ff">30</span>  <span style="color:#ae81ff">36</span>  3C  <span style="color:#ae81ff">42</span>  <span style="color:#ae81ff">48</span>  4E  <span style="color:#ae81ff">54</span>  5A  <span style="color:#ae81ff">60</span>  <span style="color:#ae81ff">66</span>  6C  <span style="color:#ae81ff">72</span>  <span style="color:#ae81ff">78</span>  7E  <span style="color:#ae81ff">84</span>  8A  <span style="color:#ae81ff">90</span>  <span style="color:#ae81ff">96</span>  9C  A2  A8  AE  B4  BA  C0  C6  CC  D2  D8  DE  E4  EA  F0  F6  FC
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">01</span>  <span style="color:#ae81ff">07</span>  0D  <span style="color:#ae81ff">13</span>  <span style="color:#ae81ff">19</span>  1F  <span style="color:#ae81ff">25</span>  2B  <span style="color:#ae81ff">31</span>  <span style="color:#ae81ff">37</span>  3D  <span style="color:#ae81ff">43</span>  <span style="color:#ae81ff">49</span>  4F  <span style="color:#ae81ff">55</span>  5B  <span style="color:#ae81ff">61</span>  <span style="color:#ae81ff">67</span>  6D  <span style="color:#ae81ff">73</span>  <span style="color:#ae81ff">79</span>  7F  <span style="color:#ae81ff">85</span>  8B  <span style="color:#ae81ff">91</span>  <span style="color:#ae81ff">97</span>  9D  A3  A9  AF  B5  BB  C1  C7  CD  D3  D9  DF  E5  EB  F1  F7  FD
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">02</span>  <span style="color:#ae81ff">08</span>  0E  <span style="color:#ae81ff">14</span>  1A  <span style="color:#ae81ff">20</span>  <span style="color:#ae81ff">26</span>  2C  <span style="color:#ae81ff">32</span>  <span style="color:#ae81ff">38</span>  3E  <span style="color:#ae81ff">44</span>  4A  <span style="color:#ae81ff">50</span>  <span style="color:#ae81ff">56</span>  5C  <span style="color:#ae81ff">62</span>  <span style="color:#ae81ff">68</span>  6E  <span style="color:#ae81ff">74</span>  7A  <span style="color:#ae81ff">80</span>  <span style="color:#ae81ff">86</span>  8C  <span style="color:#ae81ff">92</span>  <span style="color:#ae81ff">98</span>  9E  A4  AA  B0  B6  BC  C2  C8  CE  D4  DA  E0  E6  EC  F2  F8  FE
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">03</span>  <span style="color:#ae81ff">09</span>  0F  <span style="color:#ae81ff">15</span>  1B  <span style="color:#ae81ff">21</span>  <span style="color:#ae81ff">27</span>  2D  <span style="color:#ae81ff">33</span>  <span style="color:#ae81ff">39</span>  3F  <span style="color:#ae81ff">45</span>  4B  <span style="color:#ae81ff">51</span>  <span style="color:#ae81ff">57</span>  5D  <span style="color:#ae81ff">63</span>  <span style="color:#ae81ff">69</span>  6F  <span style="color:#ae81ff">75</span>  7B  <span style="color:#ae81ff">81</span>  <span style="color:#ae81ff">87</span>  8D  <span style="color:#ae81ff">93</span>  <span style="color:#ae81ff">99</span>  9F  A5  AB  B1  B7  BD  C3  C9  CF  D5  DB  E1  E7  ED  F3  F9  FF
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">04</span>  0A  <span style="color:#ae81ff">10</span>  <span style="color:#ae81ff">16</span>  1C  <span style="color:#ae81ff">22</span>  <span style="color:#ae81ff">28</span>  2E  <span style="color:#ae81ff">34</span>  3A  <span style="color:#ae81ff">40</span>  <span style="color:#ae81ff">46</span>  4C  <span style="color:#ae81ff">52</span>  <span style="color:#ae81ff">58</span>  5E  <span style="color:#ae81ff">64</span>  6A  <span style="color:#ae81ff">70</span>  <span style="color:#ae81ff">76</span>  7C  <span style="color:#ae81ff">82</span>  <span style="color:#ae81ff">88</span>  8E  <span style="color:#ae81ff">94</span>  9A  A0  A6  AC  B2  B8  BE  C4  CA  D0  D6  DC  E2  E8  EE  F4  FA
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">05</span>  0B  <span style="color:#ae81ff">11</span>  <span style="color:#ae81ff">17</span>  1D  <span style="color:#ae81ff">23</span>  <span style="color:#ae81ff">29</span>  2F  <span style="color:#ae81ff">35</span>  3B  <span style="color:#ae81ff">41</span>  <span style="color:#ae81ff">47</span>  4D  <span style="color:#ae81ff">53</span>  <span style="color:#ae81ff">59</span>  5F  <span style="color:#ae81ff">65</span>  6B  <span style="color:#ae81ff">71</span>  <span style="color:#ae81ff">77</span>  7D  <span style="color:#ae81ff">83</span>  <span style="color:#ae81ff">89</span>  8F  <span style="color:#ae81ff">95</span>  9B  A1  A7  AD  B3  B9  BF  C5  CB  D1  D7  DD  E3  E9  EF  F5  FB
</span></span></code></pre></div><p><strong>4.配置client</strong></p>
<p>修改 Tracker 服务器中的客户端配置文件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>    vim /etc/fdfs/client.conf
</span></span></code></pre></div><p>修改内容如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>    <span style="color:#75715e">#client的日志和数据目录</span>
</span></span><span style="display:flex;"><span>    base_path<span style="color:#f92672">=</span>/data/fdfs/client
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#tracker的ip端口</span>
</span></span><span style="display:flex;"><span>    tracker_server<span style="color:#f92672">=</span>ip:22122
</span></span></code></pre></div><p>创建对应目录</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>    mkdir -p /data/fdfs/client
</span></span></code></pre></div><p>上传测试</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/usr/bin/fdfs_test  /etc/fdfs/client.conf upload 1234.jpg
</span></span></code></pre></div><p>成功后信息</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>    This is FastDFS client test program v6.08
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Copyright <span style="color:#f92672">(</span>C<span style="color:#f92672">)</span> 2008, Happy Fish / YuQing
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    FastDFS may be copied only under the terms of the GNU General
</span></span><span style="display:flex;"><span>    Public License V3, which may be found in the FastDFS source kit.
</span></span><span style="display:flex;"><span>    Please visit the FastDFS Home Page http://www.fastken.com/ 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> more detail.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[</span>2022-08-09 10:39:12<span style="color:#f92672">]</span> DEBUG - base_path<span style="color:#f92672">=</span>/data/fdfs/client, connect_timeout<span style="color:#f92672">=</span>5, network_timeout<span style="color:#f92672">=</span>60, tracker_server_count<span style="color:#f92672">=</span>1, anti_steal_token<span style="color:#f92672">=</span>0, anti_steal_secret_key length<span style="color:#f92672">=</span>0, use_connection_pool<span style="color:#f92672">=</span>0, g_connection_pool_max_idle_time<span style="color:#f92672">=</span>3600s, use_storage_id<span style="color:#f92672">=</span>0, storage server id count: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    tracker_query_storage_store_list_without_group: 
</span></span><span style="display:flex;"><span>        server 1. group_name<span style="color:#f92672">=</span>, ip_addr<span style="color:#f92672">=</span>172.18.59.251, port<span style="color:#f92672">=</span><span style="color:#ae81ff">23000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    group_name<span style="color:#f92672">=</span>group1, ip_addr<span style="color:#f92672">=</span>172.18.59.251, port<span style="color:#f92672">=</span><span style="color:#ae81ff">23000</span>
</span></span><span style="display:flex;"><span>    storage_upload_by_filename
</span></span><span style="display:flex;"><span>    group_name<span style="color:#f92672">=</span>group1, remote_filename<span style="color:#f92672">=</span>M00/00/00/rBI7-2LxyNCAA_omAAF1-ZVeThs421.jpg
</span></span><span style="display:flex;"><span>    source ip address: 172.18.59.251
</span></span><span style="display:flex;"><span>    file timestamp<span style="color:#f92672">=</span>2022-08-09 10:39:12
</span></span><span style="display:flex;"><span>    file size<span style="color:#f92672">=</span><span style="color:#ae81ff">95737</span>
</span></span><span style="display:flex;"><span>    file crc32<span style="color:#f92672">=</span><span style="color:#ae81ff">2505985563</span>
</span></span><span style="display:flex;"><span>    example file url: http://172.18.59.251/group1/M00/00/00/rBI7-2LxyNCAA_omAAF1-ZVeThs421.jpg
</span></span><span style="display:flex;"><span>    storage_upload_slave_by_filename
</span></span><span style="display:flex;"><span>    group_name<span style="color:#f92672">=</span>group1, remote_filename<span style="color:#f92672">=</span>M00/00/00/rBI7-2LxyNCAA_omAAF1-ZVeThs421_big.jpg
</span></span><span style="display:flex;"><span>    source ip address: 172.18.59.251
</span></span><span style="display:flex;"><span>    file timestamp<span style="color:#f92672">=</span>2022-08-09 10:39:12
</span></span><span style="display:flex;"><span>    file size<span style="color:#f92672">=</span><span style="color:#ae81ff">95737</span>
</span></span><span style="display:flex;"><span>    file crc32<span style="color:#f92672">=</span><span style="color:#ae81ff">2505985563</span>
</span></span><span style="display:flex;"><span>    example file url: http://172.18.59.251/group1/M00/00/00/rBI7-2LxyNCAA_omAAF1-ZVeThs421_big.jpg
</span></span></code></pre></div><p>上传成功后返回文件路径：group1/M00/00/00/rBI7-2LxyNCAA_omAAF1-ZVeThs421.jpg
返回的文件路径由group、存储目录、两级子目录、fileid、文件后缀名（由客户端指定，主要用于区分文件类型）拼接而成。</p>
<p><img loading="lazy" src="filepath.jpg" alt="图片"  />
</p>
<p><strong>5.修改权限</strong></p>
<p>默认都是用root安装的</p>
<p>如果想以fdfs来维护可以修改权限</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>chown -R fdfs:fdfs /usr/bin/fdfs_*
</span></span><span style="display:flex;"><span>chown -R fdfs:fdfs /etc/fdfs
</span></span><span style="display:flex;"><span>chown -R fdfs:fdfs /data/fdfs
</span></span></code></pre></div><h3 id="fastdfs-配置-nginx-模块">FastDFS 配置 Nginx 模块<a hidden class="anchor" aria-hidden="true" href="#fastdfs-配置-nginx-模块">#</a></h3>
<p>FastDFS 通过 Tracker 服务器，将文件放在 Storage 服务器存储， 但是同组存储服务器之间需要进行文件复制， 有同步延迟的问题。</p>
<p>假设 Tracker 服务器将文件上传到了 192.168.51.128，上传成功后文件 ID已经返回给客户端。</p>
<p>此时 FastDFS 存储集群机制会将这个文件同步到同组存储 192.168.51.129，在文件还没有复制完成的情况下，客户端如果用这个文件 ID 在 192.168.51.129 上取文件,就会出现文件无法访问的错误。</p>
<p>而 fastdfs-nginx-module 可以重定向文件链接到源服务器取文件，避免客户端由于复制延迟导致的文件无法访问错误。</p>
<p>还是以root用户安装</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>cd /home/fdfs/soft
</span></span><span style="display:flex;"><span>tar -xzvf fastdfs-nginx-module-1.22.tar.gz
</span></span><span style="display:flex;"><span>cd /home/fdfs/soft/fastdfs-nginx-module-1.22/src
</span></span><span style="display:flex;"><span>cp mod_fastdfs.conf /etc/fdfs
</span></span><span style="display:flex;"><span>vim /etc/fdfs/mod_fastdfs.conf
</span></span></code></pre></div><p><code>mod_fastdfs.conf</code>修改内容如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>base_path<span style="color:#f92672">=</span>/data/fdfs/mod
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#tracker服务的ip+端口</span>
</span></span><span style="display:flex;"><span>tracker_server<span style="color:#f92672">=</span>172.18.59.251:22122
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#如果文件路径的uri中包含/group**，则要设置为true</span>
</span></span><span style="display:flex;"><span>url_have_group_name <span style="color:#f92672">=</span> true
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#同stroage服务的store_path0</span>
</span></span><span style="display:flex;"><span>store_path0<span style="color:#f92672">=</span>/data/fdfs/storage/files
</span></span></code></pre></div><p>创建目录</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mkdir -p /data/fdfs/mod
</span></span></code></pre></div><p>配置nginx，添加fastdfs-nginx-module 模块 （注意如果已经安装过nginx，那么先nginx/sbin/nginx -V看下原本的配置）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/usr/local/nginx/sbin/nginx -V
</span></span></code></pre></div><p>复制好结果备用</p>
<p><img loading="lazy" src="nginxV.jpg" alt="图片"  />
</p>
<p>重新编译nginx</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 先停掉nginx服务</span>
</span></span><span style="display:flex;"><span>/usr/local/nginx/sbin/nginx -s stop
</span></span><span style="display:flex;"><span><span style="color:#75715e">#进入nginx源码目录 </span>
</span></span><span style="display:flex;"><span>cd /usr/local/src/nginx-1.9.9/   
</span></span><span style="display:flex;"><span><span style="color:#75715e">#添加fastdfs-nginx-module 模块</span>
</span></span><span style="display:flex;"><span>./configure --prefix<span style="color:#f92672">=</span>/usr/local/nginx --with-http_ssl_module --add-module<span style="color:#f92672">=</span>/home/fdfs/soft/fastdfs-nginx-module-1.22/src
</span></span><span style="display:flex;"><span><span style="color:#75715e">#重新编译安装nginx</span>
</span></span><span style="display:flex;"><span>make
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#复制新的命令到sbin</span>
</span></span><span style="display:flex;"><span>cp /usr/local/nginx/nginx-1.9.9/objs/nginx /usr/local/nginx/sbin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#验证是否加载fastdfs-nginx-module模块是否 ，有如下标红部分表示成功</span>
</span></span><span style="display:flex;"><span>/usr/local/nginx/sbin/nginx -V
</span></span></code></pre></div><p>修改nginx.conf</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#添加如下内容</span>
</span></span><span style="display:flex;"><span>location ~/group<span style="color:#f92672">([</span>0-9<span style="color:#f92672">])</span>/M00 <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    ngx_fastdfs_module;
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>启动nginx</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/user/local/nginx/sbin/nginx
</span></span></code></pre></div><p>在浏览器访问</p>
<p>文件路径可以在使用fdfs_test再上传一个，复制返回的路径用来测试</p>
<p>http://ip:port/group1/M00/00/00/rBI7-2LzrLeAOkOqAAF1-ZVeThs773_big.jpg</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://cyf1997.github.io/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/">中间件</a></li>
      <li><a href="https://cyf1997.github.io/tags/fastdfs/">FastDFS</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://cyf1997.github.io/posts/blog/mysql/mysql%E8%A1%8C%E5%88%97%E8%BD%AC%E6%8D%A2/">
    <span class="title">« Prev</span>
    <br>
    <span>mysql行列转换</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share FastDFS on x"
            href="https://x.com/intent/tweet/?text=FastDFS&amp;url=https%3a%2f%2fcyf1997.github.io%2fposts%2fblog%2ffastdfs%2f&amp;hashtags=%e4%b8%ad%e9%97%b4%e4%bb%b6%2cFastDFS">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share FastDFS on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fcyf1997.github.io%2fposts%2fblog%2ffastdfs%2f&amp;title=FastDFS&amp;summary=FastDFS&amp;source=https%3a%2f%2fcyf1997.github.io%2fposts%2fblog%2ffastdfs%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share FastDFS on reddit"
            href="https://reddit.com/submit?url=https%3a%2f%2fcyf1997.github.io%2fposts%2fblog%2ffastdfs%2f&title=FastDFS">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share FastDFS on facebook"
            href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fcyf1997.github.io%2fposts%2fblog%2ffastdfs%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share FastDFS on whatsapp"
            href="https://api.whatsapp.com/send?text=FastDFS%20-%20https%3a%2f%2fcyf1997.github.io%2fposts%2fblog%2ffastdfs%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share FastDFS on telegram"
            href="https://telegram.me/share/url?text=FastDFS&amp;url=https%3a%2f%2fcyf1997.github.io%2fposts%2fblog%2ffastdfs%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share FastDFS on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=FastDFS&u=https%3a%2f%2fcyf1997.github.io%2fposts%2fblog%2ffastdfs%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="https://cyf1997.github.io/">图南程</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>

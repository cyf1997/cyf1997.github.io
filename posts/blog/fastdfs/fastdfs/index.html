<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>FastDFS å®‰è£… | å›¾å—ç¨‹</title>
<meta name="keywords" content="ä¸­é—´ä»¶, FastDFS">
<meta name="description" content="å¼€æºçš„è½»é‡çº§åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ">
<meta name="author" content="tunanc">
<link rel="canonical" href="https://cyf1997.github.io/posts/blog/fastdfs/fastdfs/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<link rel="icon" href="https://cyf1997.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://cyf1997.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://cyf1997.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://cyf1997.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://cyf1997.github.io/apple-touch-icon.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://cyf1997.github.io/posts/blog/fastdfs/fastdfs/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
  

<meta property="og:title" content="FastDFS å®‰è£…" />
<meta property="og:description" content="å¼€æºçš„è½»é‡çº§åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cyf1997.github.io/posts/blog/fastdfs/fastdfs/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-07-20T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-07-20T00:00:00+00:00" />



<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="FastDFS å®‰è£…"/>
<meta name="twitter:description" content="å¼€æºçš„è½»é‡çº§åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://cyf1997.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Blog",
      "item": "https://cyf1997.github.io/posts/blog/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "FastDFS å®‰è£…",
      "item": "https://cyf1997.github.io/posts/blog/fastdfs/fastdfs/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "FastDFS å®‰è£…",
  "name": "FastDFS å®‰è£…",
  "description": "å¼€æºçš„è½»é‡çº§åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ",
  "keywords": [
    "ä¸­é—´ä»¶", "FastDFS"
  ],
  "articleBody": "FastDFS ä¸€ã€ä»‹ç» äºŒã€å•èŠ‚ç‚¹å®‰è£… å¦‚æœä»¥rootç”¨æˆ·å®‰è£…ï¼Œä¸ä¿®æ”¹ä»»ä½•é…ç½®ï¼Œé»˜è®¤çš„è„šæœ¬åœ¨/usr/bin/fdfsä¸‹ï¼Œé…ç½®æ–‡ä»¶åœ¨/etc/fdfsä¸‹ï¼Œä½†æ˜¯åœ¨ç”Ÿäº§ä¸Šï¼Œrootè´¦æˆ·æˆ‘ä»¬ä¸èƒ½éšæ„å»ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ç”¨æˆ·æ¥ä½¿ç”¨fastdfs\nå®‰è£…å‰å‡†å¤‡ æ–°å»ºç”¨æˆ·\nuseradd fdfs è®¾ç½®ç”¨æˆ·å¯†ç \npasswd fdfs å®‰è£…ä¾èµ–\nyum install gcc-c++ perl-devel pcre-devel openssl-devel zlib-devel wget è½¯ä»¶ä¸Šä¼ åˆ°/home/fdfs/soft\nä¿®æ”¹æƒé™\nchown -R fdfs:fdfs /home/fdfs/ å®‰è£…å¼€å§‹ å…¨ç¨‹ä»¥rootç”¨æˆ·å®‰è£… 1.è§£å‹å®‰è£…libfastcommon-1.0.57.tar.gz\ncd /home/fdfs/soft tar -xzvf libfastcommon-1.0.57.tar.gz cd libfastcommon-1.0.57 ./make.sh ./make.sh install 2.è§£å‹å®‰è£…æ–‡ä»¶fastdfs-6.08.tar.gz\ncd /home/fdfs/soft tar -xzvf fastdfs-6.08.tar.gz cd /home/fdfs/soft/fastdfs-6.08 ./make ./make install æ‰§è¡Œå¤åˆ¶é…ç½®è„šæœ¬ï¼Œå°†è„šæœ¬å¤åˆ¶åˆ°/etc/fdfsä¸‹\n./setup.sh è„šæœ¬å‘½ä»¤ç›®å½•åœ¨/usr/binä¸‹\né…ç½®æ–‡ä»¶åœ¨/etc/fdfsä¸‹\n3.é…ç½®FastDFSè·Ÿè¸ªå™¨(Tracker)\nä¿®æ”¹é…ç½®tracker.conf\nvim /etc/fdfs/tracker.conf ä¿®æ”¹å†…å®¹å¦‚ä¸‹\n#trackeræ—¥å¿—å’Œæ•°æ®ç›®å½• base_path = /data/fdfs/tracker åˆ›å»ºbase_pathç›®å½•\nmkdir -p /data/fdfs/tracker å¯åŠ¨Tracker\n/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf start æŸ¥çœ‹ FastDFS Tracker æ˜¯å¦å·²æˆåŠŸå¯åŠ¨\n/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf status å…³é—­Trackerå‘½ä»¤\n/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf stop è®¾ç½®Trackerå¼€æœºå¯åŠ¨\nchkconfig fdfs_trackerd on tracker server ç›®å½•åŠæ–‡ä»¶ç»“æ„\n4.é…ç½® FastDFS å­˜å‚¨ (Storage)\nvim /etc/fdfs/storage.conf ä¿®æ”¹å†…å®¹å¦‚ä¸‹\n#storageçš„æ—¥å¿—å’Œæ•°æ®ç›®å½• base_path=/data/fdfs/storage #å®é™…æ–‡ä»¶å­˜æ”¾ç›®å½• store_path0=/data/fdfs/storage/files #trackerçš„ip,å¤šä¸ªå°±å¾€ä¸‹å¤åˆ¶ tracker_server=ip:22122 åˆ›å»ºå¯¹åº”ç›®å½•\nmkdir -p /data/fdfs/storage/files å¯åŠ¨ Storage\n/usr/bin/fdfs_storaged /etc/fdfs/storage.conf start æŸ¥çœ‹storageæœåŠ¡çŠ¶æ€\nservice fdfs_storaged status å…³é—­Storage\n/usr/bin/fdfs_storaged /etc/fdfs/storage.conf stop æŸ¥çœ‹Storageå’ŒTrackeræ˜¯å¦åœ¨é€šä¿¡ï¼š\n/usr/bin/fdfs_monitor /etc/fdfs/storage.conf è®¾ç½® Storage å¼€æœºå¯åŠ¨\nchkconfig fdfs_storaged on Storage ç›®å½•\nåŒ Trackerï¼ŒStorage å¯åŠ¨æˆåŠŸåï¼Œåœ¨base_path ä¸‹åˆ›å»ºäº†dataã€logsç›®å½•ï¼Œè®°å½•ç€ Storage Server çš„ä¿¡æ¯ã€‚ åœ¨ store_path0/data ç›®å½•ä¸‹ï¼Œåˆ›å»ºäº†N*Nä¸ªå­ç›®å½•ï¼š\n[root@iZ2zej7sidrziz9jw6nozvZ data]# pwd /data/fdfs/storage/files/data [root@iZ2zej7sidrziz9jw6nozvZ data]# ls 00 06 0C 12 18 1E 24 2A 30 36 3C 42 48 4E 54 5A 60 66 6C 72 78 7E 84 8A 90 96 9C A2 A8 AE B4 BA C0 C6 CC D2 D8 DE E4 EA F0 F6 FC 01 07 0D 13 19 1F 25 2B 31 37 3D 43 49 4F 55 5B 61 67 6D 73 79 7F 85 8B 91 97 9D A3 A9 AF B5 BB C1 C7 CD D3 D9 DF E5 EB F1 F7 FD 02 08 0E 14 1A 20 26 2C 32 38 3E 44 4A 50 56 5C 62 68 6E 74 7A 80 86 8C 92 98 9E A4 AA B0 B6 BC C2 C8 CE D4 DA E0 E6 EC F2 F8 FE 03 09 0F 15 1B 21 27 2D 33 39 3F 45 4B 51 57 5D 63 69 6F 75 7B 81 87 8D 93 99 9F A5 AB B1 B7 BD C3 C9 CF D5 DB E1 E7 ED F3 F9 FF 04 0A 10 16 1C 22 28 2E 34 3A 40 46 4C 52 58 5E 64 6A 70 76 7C 82 88 8E 94 9A A0 A6 AC B2 B8 BE C4 CA D0 D6 DC E2 E8 EE F4 FA 05 0B 11 17 1D 23 29 2F 35 3B 41 47 4D 53 59 5F 65 6B 71 77 7D 83 89 8F 95 9B A1 A7 AD B3 B9 BF C5 CB D1 D7 DD E3 E9 EF F5 FB 4.é…ç½®client\nä¿®æ”¹ Tracker æœåŠ¡å™¨ä¸­çš„å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶\nvim /etc/fdfs/client.conf ä¿®æ”¹å†…å®¹å¦‚ä¸‹\n#clientçš„æ—¥å¿—å’Œæ•°æ®ç›®å½• base_path=/data/fdfs/client #trackerçš„ipç«¯å£ tracker_server=ip:22122 åˆ›å»ºå¯¹åº”ç›®å½•\nmkdir -p /data/fdfs/client ä¸Šä¼ æµ‹è¯•\n/usr/bin/fdfs_test /etc/fdfs/client.conf upload 1234.jpg æˆåŠŸåä¿¡æ¯\nThis is FastDFS client test program v6.08 Copyright (C) 2008, Happy Fish / YuQing FastDFS may be copied only under the terms of the GNU General Public License V3, which may be found in the FastDFS source kit. Please visit the FastDFS Home Page http://www.fastken.com/ for more detail. [2022-08-09 10:39:12] DEBUG - base_path=/data/fdfs/client, connect_timeout=5, network_timeout=60, tracker_server_count=1, anti_steal_token=0, anti_steal_secret_key length=0, use_connection_pool=0, g_connection_pool_max_idle_time=3600s, use_storage_id=0, storage server id count: 0 tracker_query_storage_store_list_without_group: server 1. group_name=, ip_addr=172.18.59.251, port=23000 group_name=group1, ip_addr=172.18.59.251, port=23000 storage_upload_by_filename group_name=group1, remote_filename=M00/00/00/rBI7-2LxyNCAA_omAAF1-ZVeThs421.jpg source ip address: 172.18.59.251 file timestamp=2022-08-09 10:39:12 file size=95737 file crc32=2505985563 example file url: http://172.18.59.251/group1/M00/00/00/rBI7-2LxyNCAA_omAAF1-ZVeThs421.jpg storage_upload_slave_by_filename group_name=group1, remote_filename=M00/00/00/rBI7-2LxyNCAA_omAAF1-ZVeThs421_big.jpg source ip address: 172.18.59.251 file timestamp=2022-08-09 10:39:12 file size=95737 file crc32=2505985563 example file url: http://172.18.59.251/group1/M00/00/00/rBI7-2LxyNCAA_omAAF1-ZVeThs421_big.jpg ä¸Šä¼ æˆåŠŸåè¿”å›æ–‡ä»¶è·¯å¾„ï¼šgroup1/M00/00/00/rBI7-2LxyNCAA_omAAF1-ZVeThs421.jpg è¿”å›çš„æ–‡ä»¶è·¯å¾„ç”±groupã€å­˜å‚¨ç›®å½•ã€ä¸¤çº§å­ç›®å½•ã€fileidã€æ–‡ä»¶åç¼€åï¼ˆç”±å®¢æˆ·ç«¯æŒ‡å®šï¼Œä¸»è¦ç”¨äºåŒºåˆ†æ–‡ä»¶ç±»å‹ï¼‰æ‹¼æ¥è€Œæˆã€‚\n5.ä¿®æ”¹æƒé™\né»˜è®¤éƒ½æ˜¯ç”¨rootå®‰è£…çš„\nå¦‚æœæƒ³ä»¥fdfsæ¥ç»´æŠ¤å¯ä»¥ä¿®æ”¹æƒé™\nchown -R fdfs:fdfs /usr/bin/fdfs_* chown -R fdfs:fdfs /etc/fdfs chown -R fdfs:fdfs /data/fdfs FastDFS é…ç½® Nginx æ¨¡å— FastDFS é€šè¿‡ Tracker æœåŠ¡å™¨ï¼Œå°†æ–‡ä»¶æ”¾åœ¨ Storage æœåŠ¡å™¨å­˜å‚¨ï¼Œ ä½†æ˜¯åŒç»„å­˜å‚¨æœåŠ¡å™¨ä¹‹é—´éœ€è¦è¿›è¡Œæ–‡ä»¶å¤åˆ¶ï¼Œ æœ‰åŒæ­¥å»¶è¿Ÿçš„é—®é¢˜ã€‚\nå‡è®¾ Tracker æœåŠ¡å™¨å°†æ–‡ä»¶ä¸Šä¼ åˆ°äº† 192.168.51.128ï¼Œä¸Šä¼ æˆåŠŸåæ–‡ä»¶ IDå·²ç»è¿”å›ç»™å®¢æˆ·ç«¯ã€‚\næ­¤æ—¶ FastDFS å­˜å‚¨é›†ç¾¤æœºåˆ¶ä¼šå°†è¿™ä¸ªæ–‡ä»¶åŒæ­¥åˆ°åŒç»„å­˜å‚¨ 192.168.51.129ï¼Œåœ¨æ–‡ä»¶è¿˜æ²¡æœ‰å¤åˆ¶å®Œæˆçš„æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯å¦‚æœç”¨è¿™ä¸ªæ–‡ä»¶ ID åœ¨ 192.168.51.129 ä¸Šå–æ–‡ä»¶,å°±ä¼šå‡ºç°æ–‡ä»¶æ— æ³•è®¿é—®çš„é”™è¯¯ã€‚\nè€Œ fastdfs-nginx-module å¯ä»¥é‡å®šå‘æ–‡ä»¶é“¾æ¥åˆ°æºæœåŠ¡å™¨å–æ–‡ä»¶ï¼Œé¿å…å®¢æˆ·ç«¯ç”±äºå¤åˆ¶å»¶è¿Ÿå¯¼è‡´çš„æ–‡ä»¶æ— æ³•è®¿é—®é”™è¯¯ã€‚\nè¿˜æ˜¯ä»¥rootç”¨æˆ·å®‰è£…\ncd /home/fdfs/soft tar -xzvf fastdfs-nginx-module-1.22.tar.gz cd /home/fdfs/soft/fastdfs-nginx-module-1.22/src cp mod_fastdfs.conf /etc/fdfs vim /etc/fdfs/mod_fastdfs.conf mod_fastdfs.confä¿®æ”¹å†…å®¹å¦‚ä¸‹\nbase_path=/data/fdfs/mod #trackeræœåŠ¡çš„ip+ç«¯å£ tracker_server=172.18.59.251:22122 #å¦‚æœæ–‡ä»¶è·¯å¾„çš„uriä¸­åŒ…å«/group**ï¼Œåˆ™è¦è®¾ç½®ä¸ºtrue url_have_group_name = true #åŒstroageæœåŠ¡çš„store_path0 store_path0=/data/fdfs/storage/files åˆ›å»ºç›®å½•\nmkdir -p /data/fdfs/mod é…ç½®nginxï¼Œæ·»åŠ fastdfs-nginx-module æ¨¡å— ï¼ˆæ³¨æ„å¦‚æœå·²ç»å®‰è£…è¿‡nginxï¼Œé‚£ä¹ˆå…ˆnginx/sbin/nginx -Vçœ‹ä¸‹åŸæœ¬çš„é…ç½®ï¼‰\n/usr/local/nginx/sbin/nginx -V å¤åˆ¶å¥½ç»“æœå¤‡ç”¨\né‡æ–°ç¼–è¯‘nginx\n# å…ˆåœæ‰nginxæœåŠ¡ /usr/local/nginx/sbin/nginx -s stop #è¿›å…¥nginxæºç ç›®å½• cd /usr/local/src/nginx-1.9.9/ #æ·»åŠ fastdfs-nginx-module æ¨¡å— ./configure --prefix=/usr/local/nginx --with-http_ssl_module --add-module=/home/fdfs/soft/fastdfs-nginx-module-1.22/src #é‡æ–°ç¼–è¯‘å®‰è£…nginx make #å¤åˆ¶æ–°çš„å‘½ä»¤åˆ°sbin cp /usr/local/nginx/nginx-1.9.9/objs/nginx /usr/local/nginx/sbin #éªŒè¯æ˜¯å¦åŠ è½½fastdfs-nginx-moduleæ¨¡å—æ˜¯å¦ ï¼Œæœ‰å¦‚ä¸‹æ ‡çº¢éƒ¨åˆ†è¡¨ç¤ºæˆåŠŸ /usr/local/nginx/sbin/nginx -V ä¿®æ”¹nginx.conf\n#æ·»åŠ å¦‚ä¸‹å†…å®¹ location ~/group([0-9])/M00 { ngx_fastdfs_module; } å¯åŠ¨nginx\n/user/local/nginx/sbin/nginx åœ¨æµè§ˆå™¨è®¿é—®\næ–‡ä»¶è·¯å¾„å¯ä»¥åœ¨ä½¿ç”¨fdfs_testå†ä¸Šä¼ ä¸€ä¸ªï¼Œå¤åˆ¶è¿”å›çš„è·¯å¾„ç”¨æ¥æµ‹è¯•\nhttp://ip:port/group1/M00/00/00/rBI7-2LzrLeAOkOqAAF1-ZVeThs773_big.jpg\n",
  "wordCount" : "652",
  "inLanguage": "en",
  "datePublished": "2024-07-20T00:00:00Z",
  "dateModified": "2024-07-20T00:00:00Z",
  "author":[{
    "@type": "Person",
    "name": "tunanc"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://cyf1997.github.io/posts/blog/fastdfs/fastdfs/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "å›¾å—ç¨‹",
    "logo": {
      "@type": "ImageObject",
      "url": "https://cyf1997.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://cyf1997.github.io/" accesskey="h" title="å›¾å—ç¨‹ (Alt + H)">å›¾å—ç¨‹</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://cyf1997.github.io/search" title="ğŸ”æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>ğŸ”æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="https://cyf1997.github.io/" title="ğŸ ä¸»é¡µ">
                    <span>ğŸ ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://cyf1997.github.io/posts" title="ğŸ“šæ–‡ç« ">
                    <span>ğŸ“šæ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://cyf1997.github.io/archives/" title="â±æ—¶é—´è½´">
                    <span>â±æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://cyf1997.github.io/tags" title="ğŸ”–æ ‡ç­¾">
                    <span>ğŸ”–æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://cyf1997.github.io/about" title="ğŸ™‹ğŸ»â€â™‚ï¸å…³äº">
                    <span>ğŸ™‹ğŸ»â€â™‚ï¸å…³äº</span>
                </a>
            </li>
            <li>
                <a href="https://cyf1997.github.io/links" title="ğŸ¤å‹é“¾">
                    <span>ğŸ¤å‹é“¾</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://cyf1997.github.io/">Home</a>&nbsp;Â»&nbsp;<a href="https://cyf1997.github.io/posts/">Posts</a>&nbsp;Â»&nbsp;<a href="https://cyf1997.github.io/posts/blog/">Blog</a></div>
    <h1 class="post-title entry-hint-parent">
      FastDFS å®‰è£…
    </h1>
    <div class="post-description">
      å¼€æºçš„è½»é‡çº§åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ
    </div>
    <div class="post-meta"><span title='2024-07-20 00:00:00 +0000 UTC'>July 20, 2024</span>&nbsp;Â·&nbsp;4 min&nbsp;Â·&nbsp;tunanc

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#fastdfs" aria-label="FastDFS">FastDFS</a><ul>
                        
                <li>
                    <a href="#%e4%b8%80%e4%bb%8b%e7%bb%8d" aria-label="ä¸€ã€ä»‹ç»">ä¸€ã€ä»‹ç»</a></li>
                <li>
                    <a href="#%e4%ba%8c%e5%8d%95%e8%8a%82%e7%82%b9%e5%ae%89%e8%a3%85" aria-label="äºŒã€å•èŠ‚ç‚¹å®‰è£…">äºŒã€å•èŠ‚ç‚¹å®‰è£…</a><ul>
                        
                <li>
                    <a href="#%e5%ae%89%e8%a3%85%e5%89%8d%e5%87%86%e5%a4%87" aria-label="å®‰è£…å‰å‡†å¤‡">å®‰è£…å‰å‡†å¤‡</a></li>
                <li>
                    <a href="#%e5%ae%89%e8%a3%85%e5%bc%80%e5%a7%8b" aria-label="å®‰è£…å¼€å§‹">å®‰è£…å¼€å§‹</a></li>
                <li>
                    <a href="#fastdfs-%e9%85%8d%e7%bd%ae-nginx-%e6%a8%a1%e5%9d%97" aria-label="FastDFS é…ç½® Nginx æ¨¡å—">FastDFS é…ç½® Nginx æ¨¡å—</a>
                </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="fastdfs">FastDFS<a hidden class="anchor" aria-hidden="true" href="#fastdfs">#</a></h1>
<p><a href="https://github.com/happyfish100/fastdfs"><img loading="lazy" src="https://img.shields.io/badge/github-fastdfs-%2342b983" alt="github"  />
</a></p>
<h2 id="ä¸€ä»‹ç»">ä¸€ã€ä»‹ç»<a hidden class="anchor" aria-hidden="true" href="#ä¸€ä»‹ç»">#</a></h2>
<h2 id="äºŒå•èŠ‚ç‚¹å®‰è£…">äºŒã€å•èŠ‚ç‚¹å®‰è£…<a hidden class="anchor" aria-hidden="true" href="#äºŒå•èŠ‚ç‚¹å®‰è£…">#</a></h2>
<p>å¦‚æœä»¥rootç”¨æˆ·å®‰è£…ï¼Œä¸ä¿®æ”¹ä»»ä½•é…ç½®ï¼Œé»˜è®¤çš„è„šæœ¬åœ¨<code>/usr/bin/fdfs</code>ä¸‹ï¼Œé…ç½®æ–‡ä»¶åœ¨<code>/etc/fdfs</code>ä¸‹ï¼Œä½†æ˜¯åœ¨ç”Ÿäº§ä¸Šï¼Œrootè´¦æˆ·æˆ‘ä»¬ä¸èƒ½éšæ„å»ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ç”¨æˆ·æ¥ä½¿ç”¨fastdfs</p>
<h3 id="å®‰è£…å‰å‡†å¤‡">å®‰è£…å‰å‡†å¤‡<a hidden class="anchor" aria-hidden="true" href="#å®‰è£…å‰å‡†å¤‡">#</a></h3>
<p>æ–°å»ºç”¨æˆ·</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>useradd fdfs
</span></span></code></pre></div><p>è®¾ç½®ç”¨æˆ·å¯†ç </p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>passwd fdfs
</span></span></code></pre></div><p>å®‰è£…ä¾èµ–</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>yum install gcc-c++ perl-devel pcre-devel openssl-devel zlib-devel wget
</span></span></code></pre></div><p>è½¯ä»¶ä¸Šä¼ åˆ°<code>/home/fdfs/soft</code></p>
<p>ä¿®æ”¹æƒé™</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>chown -R fdfs:fdfs /home/fdfs/
</span></span></code></pre></div><h3 id="å®‰è£…å¼€å§‹">å®‰è£…å¼€å§‹<a hidden class="anchor" aria-hidden="true" href="#å®‰è£…å¼€å§‹">#</a></h3>
<p>å…¨ç¨‹ä»¥rootç”¨æˆ·å®‰è£…
<strong>1.è§£å‹å®‰è£…<code>libfastcommon-1.0.57.tar.gz</code></strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>cd /home/fdfs/soft
</span></span><span style="display:flex;"><span>tar -xzvf libfastcommon-1.0.57.tar.gz
</span></span><span style="display:flex;"><span>cd libfastcommon-1.0.57
</span></span><span style="display:flex;"><span>./make.sh
</span></span><span style="display:flex;"><span>./make.sh install
</span></span></code></pre></div><p><strong>2.è§£å‹å®‰è£…æ–‡ä»¶<code>fastdfs-6.08.tar.gz</code></strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>cd /home/fdfs/soft
</span></span><span style="display:flex;"><span>tar -xzvf fastdfs-6.08.tar.gz
</span></span><span style="display:flex;"><span>cd /home/fdfs/soft/fastdfs-6.08
</span></span><span style="display:flex;"><span>./make
</span></span><span style="display:flex;"><span>./make install
</span></span></code></pre></div><p>æ‰§è¡Œå¤åˆ¶é…ç½®è„šæœ¬ï¼Œå°†è„šæœ¬å¤åˆ¶åˆ°/etc/fdfsä¸‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>./setup.sh
</span></span></code></pre></div><p>è„šæœ¬å‘½ä»¤ç›®å½•åœ¨<code>/usr/bin</code>ä¸‹</p>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/cyf1997/BlogImg/img/usr-bin.jpg" alt="usr-bin"  />
</p>
<p>é…ç½®æ–‡ä»¶åœ¨<code>/etc/fdfs</code>ä¸‹</p>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/cyf1997/BlogImg/img/etc-fdfs.jpg" alt="etc-fdfs"  />
</p>
<p><strong>3.é…ç½®FastDFSè·Ÿè¸ªå™¨(Tracker)</strong></p>
<p>ä¿®æ”¹é…ç½®<code>tracker.conf</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>vim /etc/fdfs/tracker.conf
</span></span></code></pre></div><p>ä¿®æ”¹å†…å®¹å¦‚ä¸‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#trackeræ—¥å¿—å’Œæ•°æ®ç›®å½•</span>
</span></span><span style="display:flex;"><span>base_path <span style="color:#f92672">=</span> /data/fdfs/tracker
</span></span></code></pre></div><p>åˆ›å»º<code>base_path</code>ç›®å½•</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mkdir -p /data/fdfs/tracker
</span></span></code></pre></div><p>å¯åŠ¨Tracker</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf start
</span></span></code></pre></div><p>æŸ¥çœ‹ FastDFS Tracker æ˜¯å¦å·²æˆåŠŸå¯åŠ¨</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf status
</span></span></code></pre></div><p>å…³é—­Trackerå‘½ä»¤</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf stop
</span></span></code></pre></div><p>è®¾ç½®Trackerå¼€æœºå¯åŠ¨</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>chkconfig fdfs_trackerd on
</span></span></code></pre></div><p>tracker server ç›®å½•åŠæ–‡ä»¶ç»“æ„</p>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/cyf1997/BlogImg/img/tracker-tree.jpg" alt="tracker-tree"  />
</p>
<p><strong>4.é…ç½® FastDFS å­˜å‚¨ (Storage)</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>vim /etc/fdfs/storage.conf
</span></span></code></pre></div><p>ä¿®æ”¹å†…å®¹å¦‚ä¸‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#storageçš„æ—¥å¿—å’Œæ•°æ®ç›®å½•</span>
</span></span><span style="display:flex;"><span>base_path<span style="color:#f92672">=</span>/data/fdfs/storage
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#å®é™…æ–‡ä»¶å­˜æ”¾ç›®å½•</span>
</span></span><span style="display:flex;"><span>store_path0<span style="color:#f92672">=</span>/data/fdfs/storage/files
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#trackerçš„ip,å¤šä¸ªå°±å¾€ä¸‹å¤åˆ¶</span>
</span></span><span style="display:flex;"><span>tracker_server<span style="color:#f92672">=</span>ip:22122
</span></span></code></pre></div><p>åˆ›å»ºå¯¹åº”ç›®å½•</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mkdir -p /data/fdfs/storage/files
</span></span></code></pre></div><p>å¯åŠ¨ Storage</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/usr/bin/fdfs_storaged /etc/fdfs/storage.conf start
</span></span></code></pre></div><p>æŸ¥çœ‹storageæœåŠ¡çŠ¶æ€</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>service fdfs_storaged status
</span></span></code></pre></div><p>å…³é—­Storage</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/usr/bin/fdfs_storaged /etc/fdfs/storage.conf stop
</span></span></code></pre></div><p>æŸ¥çœ‹Storageå’ŒTrackeræ˜¯å¦åœ¨é€šä¿¡ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/usr/bin/fdfs_monitor /etc/fdfs/storage.conf
</span></span></code></pre></div><p>è®¾ç½® Storage å¼€æœºå¯åŠ¨</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>chkconfig fdfs_storaged on
</span></span></code></pre></div><p>Storage ç›®å½•</p>
<p>åŒ Trackerï¼ŒStorage å¯åŠ¨æˆåŠŸåï¼Œåœ¨base_path ä¸‹åˆ›å»ºäº†dataã€logsç›®å½•ï¼Œè®°å½•ç€ Storage Server çš„ä¿¡æ¯ã€‚
åœ¨ store_path0/data ç›®å½•ä¸‹ï¼Œåˆ›å»ºäº†N*Nä¸ªå­ç›®å½•ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>    <span style="color:#f92672">[</span>root@iZ2zej7sidrziz9jw6nozvZ data<span style="color:#f92672">]</span><span style="color:#75715e"># pwd</span>
</span></span><span style="display:flex;"><span>    /data/fdfs/storage/files/data
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[</span>root@iZ2zej7sidrziz9jw6nozvZ data<span style="color:#f92672">]</span><span style="color:#75715e"># ls</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">00</span>  <span style="color:#ae81ff">06</span>  0C  <span style="color:#ae81ff">12</span>  <span style="color:#ae81ff">18</span>  1E  <span style="color:#ae81ff">24</span>  2A  <span style="color:#ae81ff">30</span>  <span style="color:#ae81ff">36</span>  3C  <span style="color:#ae81ff">42</span>  <span style="color:#ae81ff">48</span>  4E  <span style="color:#ae81ff">54</span>  5A  <span style="color:#ae81ff">60</span>  <span style="color:#ae81ff">66</span>  6C  <span style="color:#ae81ff">72</span>  <span style="color:#ae81ff">78</span>  7E  <span style="color:#ae81ff">84</span>  8A  <span style="color:#ae81ff">90</span>  <span style="color:#ae81ff">96</span>  9C  A2  A8  AE  B4  BA  C0  C6  CC  D2  D8  DE  E4  EA  F0  F6  FC
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">01</span>  <span style="color:#ae81ff">07</span>  0D  <span style="color:#ae81ff">13</span>  <span style="color:#ae81ff">19</span>  1F  <span style="color:#ae81ff">25</span>  2B  <span style="color:#ae81ff">31</span>  <span style="color:#ae81ff">37</span>  3D  <span style="color:#ae81ff">43</span>  <span style="color:#ae81ff">49</span>  4F  <span style="color:#ae81ff">55</span>  5B  <span style="color:#ae81ff">61</span>  <span style="color:#ae81ff">67</span>  6D  <span style="color:#ae81ff">73</span>  <span style="color:#ae81ff">79</span>  7F  <span style="color:#ae81ff">85</span>  8B  <span style="color:#ae81ff">91</span>  <span style="color:#ae81ff">97</span>  9D  A3  A9  AF  B5  BB  C1  C7  CD  D3  D9  DF  E5  EB  F1  F7  FD
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">02</span>  <span style="color:#ae81ff">08</span>  0E  <span style="color:#ae81ff">14</span>  1A  <span style="color:#ae81ff">20</span>  <span style="color:#ae81ff">26</span>  2C  <span style="color:#ae81ff">32</span>  <span style="color:#ae81ff">38</span>  3E  <span style="color:#ae81ff">44</span>  4A  <span style="color:#ae81ff">50</span>  <span style="color:#ae81ff">56</span>  5C  <span style="color:#ae81ff">62</span>  <span style="color:#ae81ff">68</span>  6E  <span style="color:#ae81ff">74</span>  7A  <span style="color:#ae81ff">80</span>  <span style="color:#ae81ff">86</span>  8C  <span style="color:#ae81ff">92</span>  <span style="color:#ae81ff">98</span>  9E  A4  AA  B0  B6  BC  C2  C8  CE  D4  DA  E0  E6  EC  F2  F8  FE
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">03</span>  <span style="color:#ae81ff">09</span>  0F  <span style="color:#ae81ff">15</span>  1B  <span style="color:#ae81ff">21</span>  <span style="color:#ae81ff">27</span>  2D  <span style="color:#ae81ff">33</span>  <span style="color:#ae81ff">39</span>  3F  <span style="color:#ae81ff">45</span>  4B  <span style="color:#ae81ff">51</span>  <span style="color:#ae81ff">57</span>  5D  <span style="color:#ae81ff">63</span>  <span style="color:#ae81ff">69</span>  6F  <span style="color:#ae81ff">75</span>  7B  <span style="color:#ae81ff">81</span>  <span style="color:#ae81ff">87</span>  8D  <span style="color:#ae81ff">93</span>  <span style="color:#ae81ff">99</span>  9F  A5  AB  B1  B7  BD  C3  C9  CF  D5  DB  E1  E7  ED  F3  F9  FF
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">04</span>  0A  <span style="color:#ae81ff">10</span>  <span style="color:#ae81ff">16</span>  1C  <span style="color:#ae81ff">22</span>  <span style="color:#ae81ff">28</span>  2E  <span style="color:#ae81ff">34</span>  3A  <span style="color:#ae81ff">40</span>  <span style="color:#ae81ff">46</span>  4C  <span style="color:#ae81ff">52</span>  <span style="color:#ae81ff">58</span>  5E  <span style="color:#ae81ff">64</span>  6A  <span style="color:#ae81ff">70</span>  <span style="color:#ae81ff">76</span>  7C  <span style="color:#ae81ff">82</span>  <span style="color:#ae81ff">88</span>  8E  <span style="color:#ae81ff">94</span>  9A  A0  A6  AC  B2  B8  BE  C4  CA  D0  D6  DC  E2  E8  EE  F4  FA
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">05</span>  0B  <span style="color:#ae81ff">11</span>  <span style="color:#ae81ff">17</span>  1D  <span style="color:#ae81ff">23</span>  <span style="color:#ae81ff">29</span>  2F  <span style="color:#ae81ff">35</span>  3B  <span style="color:#ae81ff">41</span>  <span style="color:#ae81ff">47</span>  4D  <span style="color:#ae81ff">53</span>  <span style="color:#ae81ff">59</span>  5F  <span style="color:#ae81ff">65</span>  6B  <span style="color:#ae81ff">71</span>  <span style="color:#ae81ff">77</span>  7D  <span style="color:#ae81ff">83</span>  <span style="color:#ae81ff">89</span>  8F  <span style="color:#ae81ff">95</span>  9B  A1  A7  AD  B3  B9  BF  C5  CB  D1  D7  DD  E3  E9  EF  F5  FB
</span></span></code></pre></div><p><strong>4.é…ç½®client</strong></p>
<p>ä¿®æ”¹ Tracker æœåŠ¡å™¨ä¸­çš„å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>    vim /etc/fdfs/client.conf
</span></span></code></pre></div><p>ä¿®æ”¹å†…å®¹å¦‚ä¸‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>    <span style="color:#75715e">#clientçš„æ—¥å¿—å’Œæ•°æ®ç›®å½•</span>
</span></span><span style="display:flex;"><span>    base_path<span style="color:#f92672">=</span>/data/fdfs/client
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#trackerçš„ipç«¯å£</span>
</span></span><span style="display:flex;"><span>    tracker_server<span style="color:#f92672">=</span>ip:22122
</span></span></code></pre></div><p>åˆ›å»ºå¯¹åº”ç›®å½•</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>    mkdir -p /data/fdfs/client
</span></span></code></pre></div><p>ä¸Šä¼ æµ‹è¯•</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/usr/bin/fdfs_test  /etc/fdfs/client.conf upload 1234.jpg
</span></span></code></pre></div><p>æˆåŠŸåä¿¡æ¯</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>    This is FastDFS client test program v6.08
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Copyright <span style="color:#f92672">(</span>C<span style="color:#f92672">)</span> 2008, Happy Fish / YuQing
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    FastDFS may be copied only under the terms of the GNU General
</span></span><span style="display:flex;"><span>    Public License V3, which may be found in the FastDFS source kit.
</span></span><span style="display:flex;"><span>    Please visit the FastDFS Home Page http://www.fastken.com/ 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> more detail.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[</span>2022-08-09 10:39:12<span style="color:#f92672">]</span> DEBUG - base_path<span style="color:#f92672">=</span>/data/fdfs/client, connect_timeout<span style="color:#f92672">=</span>5, network_timeout<span style="color:#f92672">=</span>60, tracker_server_count<span style="color:#f92672">=</span>1, anti_steal_token<span style="color:#f92672">=</span>0, anti_steal_secret_key length<span style="color:#f92672">=</span>0, use_connection_pool<span style="color:#f92672">=</span>0, g_connection_pool_max_idle_time<span style="color:#f92672">=</span>3600s, use_storage_id<span style="color:#f92672">=</span>0, storage server id count: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    tracker_query_storage_store_list_without_group: 
</span></span><span style="display:flex;"><span>        server 1. group_name<span style="color:#f92672">=</span>, ip_addr<span style="color:#f92672">=</span>172.18.59.251, port<span style="color:#f92672">=</span><span style="color:#ae81ff">23000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    group_name<span style="color:#f92672">=</span>group1, ip_addr<span style="color:#f92672">=</span>172.18.59.251, port<span style="color:#f92672">=</span><span style="color:#ae81ff">23000</span>
</span></span><span style="display:flex;"><span>    storage_upload_by_filename
</span></span><span style="display:flex;"><span>    group_name<span style="color:#f92672">=</span>group1, remote_filename<span style="color:#f92672">=</span>M00/00/00/rBI7-2LxyNCAA_omAAF1-ZVeThs421.jpg
</span></span><span style="display:flex;"><span>    source ip address: 172.18.59.251
</span></span><span style="display:flex;"><span>    file timestamp<span style="color:#f92672">=</span>2022-08-09 10:39:12
</span></span><span style="display:flex;"><span>    file size<span style="color:#f92672">=</span><span style="color:#ae81ff">95737</span>
</span></span><span style="display:flex;"><span>    file crc32<span style="color:#f92672">=</span><span style="color:#ae81ff">2505985563</span>
</span></span><span style="display:flex;"><span>    example file url: http://172.18.59.251/group1/M00/00/00/rBI7-2LxyNCAA_omAAF1-ZVeThs421.jpg
</span></span><span style="display:flex;"><span>    storage_upload_slave_by_filename
</span></span><span style="display:flex;"><span>    group_name<span style="color:#f92672">=</span>group1, remote_filename<span style="color:#f92672">=</span>M00/00/00/rBI7-2LxyNCAA_omAAF1-ZVeThs421_big.jpg
</span></span><span style="display:flex;"><span>    source ip address: 172.18.59.251
</span></span><span style="display:flex;"><span>    file timestamp<span style="color:#f92672">=</span>2022-08-09 10:39:12
</span></span><span style="display:flex;"><span>    file size<span style="color:#f92672">=</span><span style="color:#ae81ff">95737</span>
</span></span><span style="display:flex;"><span>    file crc32<span style="color:#f92672">=</span><span style="color:#ae81ff">2505985563</span>
</span></span><span style="display:flex;"><span>    example file url: http://172.18.59.251/group1/M00/00/00/rBI7-2LxyNCAA_omAAF1-ZVeThs421_big.jpg
</span></span></code></pre></div><p>ä¸Šä¼ æˆåŠŸåè¿”å›æ–‡ä»¶è·¯å¾„ï¼šgroup1/M00/00/00/rBI7-2LxyNCAA_omAAF1-ZVeThs421.jpg
è¿”å›çš„æ–‡ä»¶è·¯å¾„ç”±groupã€å­˜å‚¨ç›®å½•ã€ä¸¤çº§å­ç›®å½•ã€fileidã€æ–‡ä»¶åç¼€åï¼ˆç”±å®¢æˆ·ç«¯æŒ‡å®šï¼Œä¸»è¦ç”¨äºåŒºåˆ†æ–‡ä»¶ç±»å‹ï¼‰æ‹¼æ¥è€Œæˆã€‚</p>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/cyf1997/BlogImg/img/filepath.jpg" alt="filepath"  />
</p>
<p><strong>5.ä¿®æ”¹æƒé™</strong></p>
<p>é»˜è®¤éƒ½æ˜¯ç”¨rootå®‰è£…çš„</p>
<p>å¦‚æœæƒ³ä»¥fdfsæ¥ç»´æŠ¤å¯ä»¥ä¿®æ”¹æƒé™</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>chown -R fdfs:fdfs /usr/bin/fdfs_*
</span></span><span style="display:flex;"><span>chown -R fdfs:fdfs /etc/fdfs
</span></span><span style="display:flex;"><span>chown -R fdfs:fdfs /data/fdfs
</span></span></code></pre></div><h3 id="fastdfs-é…ç½®-nginx-æ¨¡å—">FastDFS é…ç½® Nginx æ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#fastdfs-é…ç½®-nginx-æ¨¡å—">#</a></h3>
<p>FastDFS é€šè¿‡ Tracker æœåŠ¡å™¨ï¼Œå°†æ–‡ä»¶æ”¾åœ¨ Storage æœåŠ¡å™¨å­˜å‚¨ï¼Œ ä½†æ˜¯åŒç»„å­˜å‚¨æœåŠ¡å™¨ä¹‹é—´éœ€è¦è¿›è¡Œæ–‡ä»¶å¤åˆ¶ï¼Œ æœ‰åŒæ­¥å»¶è¿Ÿçš„é—®é¢˜ã€‚</p>
<p>å‡è®¾ Tracker æœåŠ¡å™¨å°†æ–‡ä»¶ä¸Šä¼ åˆ°äº† 192.168.51.128ï¼Œä¸Šä¼ æˆåŠŸåæ–‡ä»¶ IDå·²ç»è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
<p>æ­¤æ—¶ FastDFS å­˜å‚¨é›†ç¾¤æœºåˆ¶ä¼šå°†è¿™ä¸ªæ–‡ä»¶åŒæ­¥åˆ°åŒç»„å­˜å‚¨ 192.168.51.129ï¼Œåœ¨æ–‡ä»¶è¿˜æ²¡æœ‰å¤åˆ¶å®Œæˆçš„æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯å¦‚æœç”¨è¿™ä¸ªæ–‡ä»¶ ID åœ¨ 192.168.51.129 ä¸Šå–æ–‡ä»¶,å°±ä¼šå‡ºç°æ–‡ä»¶æ— æ³•è®¿é—®çš„é”™è¯¯ã€‚</p>
<p>è€Œ fastdfs-nginx-module å¯ä»¥é‡å®šå‘æ–‡ä»¶é“¾æ¥åˆ°æºæœåŠ¡å™¨å–æ–‡ä»¶ï¼Œé¿å…å®¢æˆ·ç«¯ç”±äºå¤åˆ¶å»¶è¿Ÿå¯¼è‡´çš„æ–‡ä»¶æ— æ³•è®¿é—®é”™è¯¯ã€‚</p>
<p>è¿˜æ˜¯ä»¥rootç”¨æˆ·å®‰è£…</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>cd /home/fdfs/soft
</span></span><span style="display:flex;"><span>tar -xzvf fastdfs-nginx-module-1.22.tar.gz
</span></span><span style="display:flex;"><span>cd /home/fdfs/soft/fastdfs-nginx-module-1.22/src
</span></span><span style="display:flex;"><span>cp mod_fastdfs.conf /etc/fdfs
</span></span><span style="display:flex;"><span>vim /etc/fdfs/mod_fastdfs.conf
</span></span></code></pre></div><p><code>mod_fastdfs.conf</code>ä¿®æ”¹å†…å®¹å¦‚ä¸‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>base_path<span style="color:#f92672">=</span>/data/fdfs/mod
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#trackeræœåŠ¡çš„ip+ç«¯å£</span>
</span></span><span style="display:flex;"><span>tracker_server<span style="color:#f92672">=</span>172.18.59.251:22122
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#å¦‚æœæ–‡ä»¶è·¯å¾„çš„uriä¸­åŒ…å«/group**ï¼Œåˆ™è¦è®¾ç½®ä¸ºtrue</span>
</span></span><span style="display:flex;"><span>url_have_group_name <span style="color:#f92672">=</span> true
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#åŒstroageæœåŠ¡çš„store_path0</span>
</span></span><span style="display:flex;"><span>store_path0<span style="color:#f92672">=</span>/data/fdfs/storage/files
</span></span></code></pre></div><p>åˆ›å»ºç›®å½•</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mkdir -p /data/fdfs/mod
</span></span></code></pre></div><p>é…ç½®nginxï¼Œæ·»åŠ fastdfs-nginx-module æ¨¡å— ï¼ˆæ³¨æ„å¦‚æœå·²ç»å®‰è£…è¿‡nginxï¼Œé‚£ä¹ˆå…ˆnginx/sbin/nginx -Vçœ‹ä¸‹åŸæœ¬çš„é…ç½®ï¼‰</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/usr/local/nginx/sbin/nginx -V
</span></span></code></pre></div><p>å¤åˆ¶å¥½ç»“æœå¤‡ç”¨</p>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/cyf1997/BlogImg/img/nginxV.jpg" alt="nginxV"  />
</p>
<p>é‡æ–°ç¼–è¯‘nginx</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># å…ˆåœæ‰nginxæœåŠ¡</span>
</span></span><span style="display:flex;"><span>/usr/local/nginx/sbin/nginx -s stop
</span></span><span style="display:flex;"><span><span style="color:#75715e">#è¿›å…¥nginxæºç ç›®å½• </span>
</span></span><span style="display:flex;"><span>cd /usr/local/src/nginx-1.9.9/   
</span></span><span style="display:flex;"><span><span style="color:#75715e">#æ·»åŠ fastdfs-nginx-module æ¨¡å—</span>
</span></span><span style="display:flex;"><span>./configure --prefix<span style="color:#f92672">=</span>/usr/local/nginx --with-http_ssl_module --add-module<span style="color:#f92672">=</span>/home/fdfs/soft/fastdfs-nginx-module-1.22/src
</span></span><span style="display:flex;"><span><span style="color:#75715e">#é‡æ–°ç¼–è¯‘å®‰è£…nginx</span>
</span></span><span style="display:flex;"><span>make
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#å¤åˆ¶æ–°çš„å‘½ä»¤åˆ°sbin</span>
</span></span><span style="display:flex;"><span>cp /usr/local/nginx/nginx-1.9.9/objs/nginx /usr/local/nginx/sbin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#éªŒè¯æ˜¯å¦åŠ è½½fastdfs-nginx-moduleæ¨¡å—æ˜¯å¦ ï¼Œæœ‰å¦‚ä¸‹æ ‡çº¢éƒ¨åˆ†è¡¨ç¤ºæˆåŠŸ</span>
</span></span><span style="display:flex;"><span>/usr/local/nginx/sbin/nginx -V
</span></span></code></pre></div><p>ä¿®æ”¹nginx.conf</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#æ·»åŠ å¦‚ä¸‹å†…å®¹</span>
</span></span><span style="display:flex;"><span>location ~/group<span style="color:#f92672">([</span>0-9<span style="color:#f92672">])</span>/M00 <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    ngx_fastdfs_module;
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>å¯åŠ¨nginx</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/user/local/nginx/sbin/nginx
</span></span></code></pre></div><p>åœ¨æµè§ˆå™¨è®¿é—®</p>
<p>æ–‡ä»¶è·¯å¾„å¯ä»¥åœ¨ä½¿ç”¨fdfs_testå†ä¸Šä¼ ä¸€ä¸ªï¼Œå¤åˆ¶è¿”å›çš„è·¯å¾„ç”¨æ¥æµ‹è¯•</p>
<p>http://ip:port/group1/M00/00/00/rBI7-2LzrLeAOkOqAAF1-ZVeThs773_big.jpg</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://cyf1997.github.io/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/">ä¸­é—´ä»¶</a></li>
      <li><a href="https://cyf1997.github.io/tags/fastdfs/">FastDFS</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://cyf1997.github.io/posts/blog/mysql/mysql%E8%A1%8C%E5%88%97%E8%BD%AC%E6%8D%A2/">
    <span class="title">Â« Prev</span>
    <br>
    <span>mysqlè¡Œåˆ—è½¬æ¢</span>
  </a>
</nav>

  </footer><script src="https://giscus.app/client.js"
        data-repo="cyf1997/cyf1997.github.io"
        data-repo-id="R_kgDOMZ1AOA"
        data-category="Announcements"
        data-category-id="DIC_kwDOMZ1AOM4ChH7B"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="zh-CN"
        crossorigin="anonymous"
        async>
</script>

</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="https://cyf1997.github.io/">å›¾å—ç¨‹</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
